// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id       Int    @id @default(autoincrement())
  username String @unique @db.VarChar(255)
  password String @db.VarChar(255)

  preventivi Preventivo[]
}

model Fornitore {
  id   Int    @id @default(autoincrement())
  nome String @unique @db.VarChar(255)

  Listino Listino[]
}

model Listino {
  id          Int      @id @default(autoincrement())
  createdAt   DateTime @updatedAt()
  fornitoreId Int
  nome        String   @unique @db.VarChar(255)

  fornitore         Fornitore           @relation(fields: [fornitoreId], references: [id])
  Prodotto          Prodotto[]
  Personalizzazione Personalizzazione[]
  Preventivo        Preventivo[]
}

model Prodotto {
  id        Int     @id @default(autoincrement())
  nome      String  @db.VarChar(255)
  prezzo    Decimal @db.Decimal(10, 2)
  listinoId Int

  listino    Listino         @relation(fields: [listinoId], references: [id], onDelete: Cascade)
  quotazioni PreventivoRow[]

  @@unique([nome, listinoId])
}

model Personalizzazione {
  id        Int     @id @default(autoincrement())
  nome      String  @db.VarChar(255)
  prezzo    Decimal @db.Decimal(10, 2)
  listinoId Int

  quotazioni PreventivoRow[]
  listino    Listino         @relation(fields: [listinoId], references: [id], onDelete: Cascade)

  @@unique([nome, listinoId])
}

model Preventivo {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  nome      String   @db.VarChar(255)
  scuola    String   @db.VarChar(100)
  listinoId Int
  userId    Int

  rows         PreventivoRow[]
  listino      Listino         @relation(fields: [listinoId], references: [id])
  lastEditedBy User            @relation(fields: [userId], references: [id])
}

model PreventivoRow {
  id                  Int     @id @default(autoincrement())
  provvigioneSC       Decimal @db.Decimal(10, 2)
  provvigioneRappre   Decimal @db.Decimal(10, 2)
  provvigioneComm     Decimal @db.Decimal(10, 2)
  preventivoId        Int
  prodottoId          Int
  personalizzazioneId Int

  preventivo        Preventivo        @relation(fields: [preventivoId], references: [id], onDelete: Cascade)
  prodotto          Prodotto          @relation(fields: [prodottoId], references: [id], onDelete: Cascade)
  personalizzazione Personalizzazione @relation(fields: [personalizzazioneId], references: [id], onDelete: Cascade)
}
